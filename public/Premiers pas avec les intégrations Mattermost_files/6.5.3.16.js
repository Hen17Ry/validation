(window.mutinyWpJsonp=window.mutinyWpJsonp||[]).push([[6],{46:function(e,t,n){"use strict";n.d(t,"e",(function(){return u})),n.d(t,"d",(function(){return l})),n.d(t,"c",(function(){return p})),n.d(t,"b",(function(){return h})),n.d(t,"a",(function(){return m}));var i=n(34),r=n(0),o=n(5),s=n(13),a=n(10),c=n(1);const d=(e,t)=>Object(c.b)(e,{[i.b]:r.d.AssetViewer,[i.j]:null==t?void 0:t.sessionToken,[i.k]:null==t?void 0:t.visitorToken}),u=(e,t)=>({assetCtaText:e.asset.cta_text,assetDescription:e.asset.description,assetId:e.asset.id,assetImageUrl:e.asset.image_url,assetTitle:e.asset.title,assetUrl:d(e.asset.url,t),eventId:e.event_id}),l=()=>{var e;window.parent!==window&&window.parent.postMessage({type:r.j.AssetViewerLoaded,height:(null===(e=document.body)||void 0===e?void 0:e.clientHeight)||0},"*")},p=()=>{window.setInterval(l,1e4)},h=()=>{const e=Object(o.a)("style");e.nonce=Object(s.a)(),e.innerHTML="\n    body::-webkit-scrollbar {\n      display: none;\n    };\n\n    body {\n      overflow-style: none;\n      scrollbar-width: none;\n    };\n  ",Object(a.b)(document,"documentElement").then(t=>t.append(e))},m=()=>{const e=Object(o.a)("base");e.target="_parent";let t=!1;Object(a.b)(document,"head").then(n=>{t||(t=!0,n.append(e))}),Object(a.b)(document,"body").then(n=>{t||(t=!0,n.append(e))})}},70:function(e,t,n){"use strict";n.d(t,"b",(function(){return i})),n.d(t,"a",(function(){return r}));const i=e=>{"complete"===document.readyState?e():window.addEventListener("load",e)},r=e=>{window.location.assign(e)}},97:function(e,t,n){"use strict";n.r(t),n.d(t,"initializeMutiny",(function(){return H}));n(74),n(67);var i=n(9),r=n(33),o=n(56),s=n(3),a=n(5),c=n(13);const d=new s.a("highlights");var u=n(0),l=n(46),p=n(70),h=n(6),m=n(18),y=n(65),g=function(e,t){var n={};for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&t.indexOf(i)<0&&(n[i]=e[i]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var r=0;for(i=Object.getOwnPropertySymbols(e);r<i.length;r++)t.indexOf(i[r])<0&&Object.prototype.propertyIsEnumerable.call(e,i[r])&&(n[i[r]]=e[i[r]])}return n};var f=n(7),v=n(41),b=n(1),x=n(62),w=n(34);const S="mutiny-custom-javascript";var _=n(58),j=n(17),O=n(57),q=n(72);n(47);class E{constructor(e,t,n,i,r){this.audienceSegment=e,this.webExperience=t,this.mutinyClientData=n,this.context=i,this.personalizeType=r,this.logger=new s.a("questionnaire-render"),this.preactContainerId="mutiny-preact-"+this.webExperience.id,this.stylesheet=this.mutinyClientData.stylesheets.find(({id:e})=>e===this.webExperience.component_stylesheet_id),this.stylesheetElementId=this.stylesheet&&"mutiny-stylesheet-"+this.stylesheet.id}attach(){return new Promise(e=>{requestAnimationFrame(()=>{n.e(0).then(n.bind(null,71)).then(({default:t})=>{Promise.resolve().then(n.bind(null,30)).then(({h:n,render:i})=>{let r=document.querySelector("#"+this.preactContainerId);if(r||(r=Object(a.a)("div"),r.setAttribute("id",this.preactContainerId),document.body.prepend(r)),this.stylesheet&&this.stylesheetElementId&&!document.querySelector("#"+this.stylesheetElementId)){const e=Object(a.a)("style");e.nonce=Object(c.a)(),e.setAttribute("id",this.stylesheetElementId),e.innerHTML=this.stylesheet.stylesheet,document.head.append(e),this.logger.info("Attaching component stylesheet",e)}return this.webExperience.questionnaire&&(this.logger.debug("Rendering component",this.webExperience.questionnaire),i(n(t,{audienceSegment:this.audienceSegment,context:this.context,personalizeType:this.personalizeType,questionnaire:this.webExperience.questionnaire,userData:this.context.userDataStore,webExperience:this.webExperience}),r),this.attachQuestionnaireCompleteHandler()),e(!1)})})})})}teardown(){const e=document.querySelector("#"+this.preactContainerId);if(e&&e.remove(),this.stylesheetElementId){const e=document.querySelector("#"+this.stylesheetElementId);e&&e.remove()}}attachQuestionnaireCompleteHandler(){document.addEventListener("mutiny:questionnaire-complete",()=>{const e=(t=this.mutinyClientData.audience_segments,n="person.questionnaire."+this.webExperience.questionnaire.key,t.filter(e=>e.web_experiences.some(e=>(e.data_dependencies||[]).some(e=>e.startsWith(n)))));var t,n;if(e.length>0)return this.logger.info("Found dependent segments to re-evaluate",e),I(R(e,this.context,{alwaysEvaluate:!0}),this.mutinyClientData,this.context);this.logger.info("Found no dependent segments")})}}var k=new class{constructor(){var e,t,n,i,r;this.stylesheet=new CSSStyleSheet,document.adoptedStyleSheets=[...null!==(e=document.adoptedStyleSheets)&&void 0!==e?e:[],this.stylesheet],this.reset();const o=document.querySelector("style[data-mutiny-headless-styles]");let s=0;for(;(null!==(i=null===(n=null===(t=null==o?void 0:o.sheet)||void 0===t?void 0:t.cssRules)||void 0===n?void 0:n.length)&&void 0!==i?i:0)>0&&s++<100;)null===(r=null==o?void 0:o.sheet)||void 0===r||r.deleteRule(0)}attachExperience(e,t){for(const n of this.styleForExperience(e,t))this.stylesheet.insertRule(n,this.stylesheet.cssRules.length)}reset(){this.stylesheet.replaceSync(this.baseStyles())}setContext(e){this.context=e}getContext(){return this.context}baseStyles(){return"\n      @layer mutiny-headless-presentation, mutiny-headless-hider;\n    \n      @layer mutiny-headless-presentation {\n        mutiny-personalization > mutiny-variation[control] {\n          display: initial;\n        }\n  \n        mutiny-personalization > mutiny-variation:not([control]) {\n          display: none;\n        }\n      }\n    "}styleForExperience(e,t){return t?[`\n          @layer mutiny-headless-presentation {\n            mutiny-personalization > mutiny-variation[experience-id="${e}"][variation-id="${t}"] {\n              display: initial;  \n            }\n          }\n        `,`\n          @layer mutiny-headless-hider {\n            mutiny-personalization:has(mutiny-variation[experience-id="${e}"][variation-id="${t}"]) > mutiny-variation[control] {\n              display: none;\n            }\n\n            mutiny-personalization > mutiny-variation[experience-id="${e}"][variation-id="${t}"] ~ mutiny-variation {\n              display: none;\n            }\n          }\n        `]:[]}};function C(e,t,n,i,o){const d=new s.a("page-render"),l=Object(_.a)(e,t,n.userDataStore,i),p=l===u.w.Personalized;let h;const m=e.experience_type===u.k.Redirect&&e.redirect_url;if(e.experience_type===u.k.Render){const t=new O.a(p,e.dom_updates.map(t=>new q.a(t,n.userDataStore,n.componentPrioritizer,n.exporter,void 0,o.blocks,e.dom_update_group_id)),[],n,"update-renderer");h=t.renderAsync(),d.info("Attaching state change event listener"),document.addEventListener(u.j.StateChange,()=>{d.info("Received state change event, tearing down DOMRenderer"),t.teardown()},{once:!0})}else if(e.experience_type===u.k.Headless)k.attachExperience(e.id,p?e.variation_key:void 0),h=Promise.resolve(!0);else if(e.experience_type===u.k.Questionnaire&&e.questionnaire)if(2===e.questionnaire.version){const i=new E(t,e,o,n,l);h=new Promise(t=>{var r;const o=(null===(r=e.questionnaire)||void 0===r?void 0:r.questionnaire_type)===u.z.TopBar;e.questionnaire&&o&&n.componentPrioritizer.onShouldRender(e.questionnaire.resource_id,()=>(i.attach().then(t),!0)),i.attach().then(t)}),document.addEventListener(u.j.StateChange,()=>{d.info("Received state change event, tearing down QuestionnaireRenderer"),i.teardown()},{once:!0})}else n.exporter.track(r.a.Metric,{metricKey:"client.render.questionnaireV1",metricType:u.q.Increment}),h=Promise.resolve(!1);else m?(p||n.setRedirecting(!1),h=Promise.resolve(!0)):h=Promise.resolve(!1);return h.then(o=>{if(n.componentPrioritizer.render(),!i&&o&&n.exporter.track(r.a.ExperienceImpression,{audienceSegment:t,campaignAccountId:n.userDataStore.get(t.campaign_slug+".campaign_account_id"),personIdentificationToken:n.userDataStore.get("query."+w.h),experience:e,impressionType:l}),m&&p){const t=Object(j.c)(e.redirect_url,n.userDataStore),i=n.config.preserve_redirect_query_params?Object(b.h)(t):t;n.exporter.track(r.a.Metric,{metricKey:"client.render.redirect.time",metricType:u.q.Timing,value:performance.now()}),n.exporter.forceFlushQueues().finally(()=>{d.info("Executing redirect to "+i),window.location.replace(i)})}p&&function(e,t){const n=[S,e.id].join("-");if(e.custom_javascript&&!document.querySelector("#"+n)){const i=Object(a.a)("script");i.nonce=Object(c.a)(),i.setAttribute("type","text/javascript"),i.setAttribute("id",n),i.innerHTML=e.custom_javascript,document.head.append(i),t.info("Attaching global custom javascript")}}(e,d)}),Object(x.b)({experience:e,audienceSegment:t,impressionType:l}),h}function R(e,t,{async:n,alwaysEvaluate:i}){const{preview:r,userDataStore:a,clientMode:c}=t,d=new s.a("attach-experiences");d.info("Evaluating audienceSegments",e);const{activeSegments:u}=function({userDataStore:e,audienceSegments:t},n){var i,r;let s;const a=Object(h.c)(),c=null!==(i=null==a?void 0:a.experience_id)&&void 0!==i?i:e.get(o.b),d=null!==(r=null==a?void 0:a.variation_id)&&void 0!==r?r:e.get(o.c);return s=d&&!n?t.map(e=>{var{web_experiences:t}=e,n=g(e,["web_experiences"]);return Object.assign(Object.assign({},n),{web_experiences:t.filter(({variation_key:e})=>String(e)===String(d))})}):c&&!n?t.map(e=>{var{web_experiences:t}=e,n=g(e,["web_experiences"]);return Object.assign(Object.assign({},n),{web_experiences:t.filter(({id:e})=>String(e)===String(c))})}):t.filter(t=>Object(y.b)(t,e)).map(t=>{var{web_experiences:n}=t,i=g(t,["web_experiences"]);return Object.assign(Object.assign({},i),{web_experiences:n.filter(({condition:t})=>Object(m.b)(t,e))})}),{activeSegments:s}}({audienceSegments:e,userDataStore:a},i);u.length>0&&d.info("Found activeSegments",u);return u.reduce((e,t)=>e.concat(Object(b.c)(t.web_experiences,r).filter(e=>void 0===n||n===e.async).map(e=>({audienceSegment:t,experience:e})).filter(e=>Object(v.a)(e,c))),[])}function I(e,t,n){const{preview:i,userDataStore:r,componentPrioritizer:o}=n,a=new s.a("attach-experiences");e.length>0?a.info("Found activeSegments for URL",e):a.info("Did not find any active segments for URL",e);const c=(e,t)=>e.experience.priority-t.experience.priority,d=e.filter(({experience:{global:e},audienceSegment:{objective:t}})=>!e&&t===u.u.AbmOutbound).find(({experience:{id:e}})=>e===r.get("person_identification_token.web_experience_id")||i===u.x.Preview),l=e.filter(({experience:{global:e},audienceSegment:{campaign_slug:t}})=>!e&&t).sort(c),p=e.filter(({experience:{global:e},audienceSegment:{campaign_slug:t,objective:n}})=>!e&&!t&&n!==u.u.AbmOutbound),h=e.filter(({experience:{experience_type:e,redirect_url:t}})=>e===u.k.Redirect&&!Object(b.k)(t||"",window.location.href)).sort(c),m=p.filter(({experience:{experience_type:e,questionnaire:t}})=>e===u.k.Questionnaire&&t&&t.questionnaire_type!==u.z.ExitIntentModal).sort(c),y=p.filter(({experience:{experience_type:e,questionnaire:t}})=>e===u.k.Questionnaire&&t&&t.questionnaire_type===u.z.ExitIntentModal).sort(c),g=e.filter(({experience:{questionnaire:e,global:t}})=>t&&(0===m.length||(null==e?void 0:e.questionnaire_type)!==m[0].experience.questionnaire.questionnaire_type)&&(0===y.length||(null==e?void 0:e.questionnaire_type)!==y[0].experience.questionnaire.questionnaire_type)),v=p.filter(({experience:{experience_type:e}})=>[u.k.Render,u.k.Headless].includes(e)).sort(c);e.length>0&&(a.info("abmOutboundSegment",d),a.info("campaignSegments",l),a.info("redirectSegments",h),a.info("renderOrHeadlessSegments",v),a.info("questionnaireSegments",m),a.info("exitIntentSegments",y),a.info("concurrentSegments",g));let x=[];return d?x=[d,...g]:l.length>0?x=[l[0],...g]:h.length>0?(x=[h[0]],n.setRedirecting(!0)):x=[v[0],m[0],y[0],...g].filter(f.c),o.registerExperiences(x),x.length>0?a.info("Found segmentsToRender",x):a.info("Did not find any segmentsToRender",x),Promise.all(x.map(({experience:e,audienceSegment:r})=>C(e,r,n,i,t))).then(e=>e.every(f.c))}function T(e,t,n){return I(R(e.audience_segments,t,{async:n}),e,t)}var D=n(52),P=n(16),z=function(e,t,n,i){return new(n||(n=Promise))((function(r,o){function s(e){try{c(i.next(e))}catch(e){o(e)}}function a(e){try{c(i.throw(e))}catch(e){o(e)}}function c(e){var t;e.done?r(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(s,a)}c((i=i.apply(e,t||[])).next())}))};function A(e,t){t.clientMode===u.d.AssetViewer?Object(D.a)(t):t.exporter.page();const i=t.ensureShouldRender(()=>{t.componentPrioritizer.reset(),T(e,t,!1)},"Skipping attachExperiences for synchronous experiences");return Object(l.d)(),n.e(7).then(n.bind(null,96)).then(({attachEvents:n})=>n(e,t)),i}function M(e){const t=e.timer.getTimeInMilliseconds();t&&e.exporter.track(r.a.Time,{timeInSeconds:t/1e3}),e.exporter.forceFlushQueues()}const H=Object(i.d)((e,t,n)=>z(void 0,void 0,void 0,(function*(){const i=new s.a("index"),r=Object(o.d)(e,t,n);if(r.apiClient.trackMetric({metricKey:"client.attached",metricType:u.q.Increment},!0),document.documentElement.dataset.mutinyLoaded)return i.error("Client data or initializeMutiny function took too long to download. Skipping personalization."),void r.apiClient.trackMetric({metricKey:"client.client_data.fetch.timed_out",metricType:u.q.Increment},!0);if(r.onPageHide(()=>r.apiClient.trackMetric({metricKey:"client.detached",metricType:u.q.Increment},!0)),r.shouldExitBeforeUserDataFetch())return i.info("Exiting before user data fetch"),void t.removeHider(!0,"Exiting early before user data fetch");if(function(e){if(!e.highlightPersonalizations)return;const t=Object(a.a)("style");t.type="text/css",t.id="mutiny-highlight-styles",t.nonce=Object(c.a)(),t.append(document.createTextNode('\n      [data-mutiny-root="true"] {\n        outline: 3px solid rgba(150, 15, 223, 0.5);\n      }\n    ')),document.head.append(t),d.info("attached highlight styles",t)}(r),yield r.ensureShouldRender(()=>r.userDataClient.getUserData(),"Skipping user data request"),r.shouldExitAfterUserDataFetch())return i.info("Exiting after user data fetch"),void t.removeHider(!0,"Exiting early after user data fetch");r.clientMode===u.d.AssetViewer&&(Object(l.a)(),Object(l.b)()),r.exporter.identify(),Object(p.b)(()=>{Object(l.d)(),Object(l.c)()}),r.stateChangeHandler.onChange(()=>{M(r),r.timer.restart(),r.timer.setMarker(window.location.toString())}),r.onPageHide(()=>M(r));const h=r.ensureShouldRender(()=>function(e,t){return Object(v.d)(e)?t.userDataClient.getAsyncUserData():Promise.resolve()}(e,r),"Skipping async user data request");r.stateChangeHandler.onChange(()=>r.events.trigger(u.j.StateChange)),r.stateChangeHandler.onChange(()=>{!function(e){e.info("Tearing down custom javascript");for(const t of Array.from(document.querySelectorAll(`script[id*=${S}]`)))e.info("Removing custom javascript "+t.id),t.remove()}(i),k.reset(),k.setContext(r),A(e,r),r.ensureShouldRender(()=>T(e,r,!0),"Skipping attaching async experiences")}),A(e,r).then(()=>{r.isRedirecting()||t.removeHider(!0,"initial render for synchronous experiences has finished")}).catch(e=>{throw t.removeHider(!1,"synchronous render promise failed"),e}),r.ensureShouldRender(()=>h.then(()=>T(e,r,!0)),"Skipping attachExperiences for async experiences"),r.ensureShouldRender(()=>Object(P.c)(r.exporter),"Skipping reporting real user metrics")})))}}]);